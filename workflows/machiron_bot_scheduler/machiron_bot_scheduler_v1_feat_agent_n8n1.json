[{"nodes":"[\n  {\n    \"parameters\": {\n      \"httpMethod\": \"POST\",\n      \"path\": \"9fcb2a36-340b-4630-abe3-975826678b72\",\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.webhook\",\n    \"typeVersion\": 2,\n    \"position\": [\n      -140,\n      0\n    ],\n    \"id\": \"c1108483-9ded-40f5-ad5d-08e6c05712fc\",\n    \"name\": \"Webhook\",\n    \"webhookId\": \"9fcb2a36-340b-4630-abe3-975826678b72\"\n  },\n  {\n    \"parameters\": {\n      \"assignments\": {\n        \"assignments\": [\n          {\n            \"id\": \"9aaac50e-3262-4fea-ad43-9cdf44d36fa2\",\n            \"name\": \"numCilente\",\n            \"value\": \"={{ $json.body.data.key.remoteJid }}\",\n            \"type\": \"string\"\n          },\n          {\n            \"id\": \"f219356d-cb0e-4b7e-88a2-4dc55943cc15\",\n            \"name\": \"numEmpresa\",\n            \"value\": \"={{ $json.body.sender }}\",\n            \"type\": \"string\"\n          },\n          {\n            \"id\": \"4ac047e5-7b5b-48cb-9736-95d34e116c68\",\n            \"name\": \"nomeCliente\",\n            \"value\": \"={{ $json.body.data.pushName }}\",\n            \"type\": \"string\"\n          },\n          {\n            \"id\": \"f59590f6-0140-4e61-be97-cfa12f89eefd\",\n            \"name\": \"instance\",\n            \"value\": \"={{ $json.body.data.instanceId }}\",\n            \"type\": \"string\"\n          },\n          {\n            \"id\": \"53ea213d-e90e-48b2-afcc-43d4835c203a\",\n            \"name\": \"msg\",\n            \"value\": \"={{ $json.body.data.message.conversation }}\",\n            \"type\": \"string\"\n          },\n          {\n            \"id\": \"112a6a2a-e8b1-458e-a9c3-d55f62d89216\",\n            \"name\": \"msgType\",\n            \"value\": \"={{ $json.body.data.messageType }}\",\n            \"type\": \"string\"\n          },\n          {\n            \"id\": \"cea398ec-ca8a-465f-b69b-2c5dfadf9ca0\",\n            \"name\": \"msgID\",\n            \"value\": \"={{ $json.body.data.key.id }}\",\n            \"type\": \"string\"\n          },\n          {\n            \"id\": \"b219da5b-19a3-4030-b9b2-dc08ef65633f\",\n            \"name\": \"base64\",\n            \"value\": \"={{ $json.body.data.message.base64 }}\",\n            \"type\": \"string\"\n          },\n          {\n            \"id\": \"a114f702-a022-42c6-b4bd-139b63da8ec2\",\n            \"name\": \"instanceIDtelcliente\",\n            \"value\": \"={{ $json.body.data.instanceId }}{{ $json.body.data.key.remoteJid }}\",\n            \"type\": \"string\"\n          }\n        ]\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.set\",\n    \"typeVersion\": 3.4,\n    \"position\": [\n      140,\n      0\n    ],\n    \"id\": \"a4fec0b1-e060-42aa-8292-fa9fa2d7a0a8\",\n    \"name\": \"Campos iniciais\"\n  },\n  {\n    \"parameters\": {\n      \"conditions\": {\n        \"options\": {\n          \"caseSensitive\": true,\n          \"leftValue\": \"\",\n          \"typeValidation\": \"strict\",\n          \"version\": 2\n        },\n        \"conditions\": [\n          {\n            \"id\": \"1f255b8b-70a6-4209-93ac-7d58873daca9\",\n            \"leftValue\": \"={{ $('Webhook').item.json.body.data.key.fromMe }}\",\n            \"rightValue\": \"\",\n            \"operator\": {\n              \"type\": \"boolean\",\n              \"operation\": \"true\",\n              \"singleValue\": true\n            }\n          }\n        ],\n        \"combinator\": \"and\"\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.if\",\n    \"typeVersion\": 2.2,\n    \"position\": [\n      420,\n      0\n    ],\n    \"id\": \"42385b73-e7d3-4f05-9860-2c751e7cf310\",\n    \"name\": \"A Empresa assumiu o atendimento?\"\n  },\n  {\n    \"parameters\": {\n      \"operation\": \"select\",\n      \"schema\": {\n        \"__rl\": true,\n        \"mode\": \"list\",\n        \"value\": \"public\"\n      },\n      \"table\": {\n        \"__rl\": true,\n        \"value\": \"empresa\",\n        \"mode\": \"list\",\n        \"cachedResultName\": \"empresa\"\n      },\n      \"where\": {\n        \"values\": [\n          {\n            \"column\": \"telefonewhatsapp\",\n            \"value\": \"={{ $('A Empresa assumiu o atendimento?').item.json.numEmpresa }}\"\n          }\n        ]\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.postgres\",\n    \"typeVersion\": 2.6,\n    \"position\": [\n      720,\n      100\n    ],\n    \"id\": \"54b75c5d-7b83-4d09-a709-c2030427bef0\",\n    \"name\": \"get_empresa\",\n    \"credentials\": {\n      \"postgres\": {\n        \"id\": \"LqGFAFaRsmM4ACIk\",\n        \"name\": \"Postgres account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"operation\": \"select\",\n      \"schema\": {\n        \"__rl\": true,\n        \"mode\": \"list\",\n        \"value\": \"public\"\n      },\n      \"table\": {\n        \"__rl\": true,\n        \"value\": \"clientes\",\n        \"mode\": \"list\",\n        \"cachedResultName\": \"clientes\"\n      },\n      \"where\": {\n        \"values\": [\n          {\n            \"column\": \"telefonewhatsapp\",\n            \"value\": \"={{ $('Campos iniciais').item.json.numCilente }}\"\n          },\n          {\n            \"column\": \"idempresa\",\n            \"value\": \"={{ $json.id }}\"\n          }\n        ]\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.postgres\",\n    \"typeVersion\": 2.6,\n    \"position\": [\n      940,\n      100\n    ],\n    \"id\": \"66d92b4e-fe1c-421b-875b-48ab87fba0bc\",\n    \"name\": \"get_cliente\",\n    \"alwaysOutputData\": true,\n    \"credentials\": {\n      \"postgres\": {\n        \"id\": \"LqGFAFaRsmM4ACIk\",\n        \"name\": \"Postgres account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"conditions\": {\n        \"options\": {\n          \"caseSensitive\": true,\n          \"leftValue\": \"\",\n          \"typeValidation\": \"strict\",\n          \"version\": 2\n        },\n        \"conditions\": [\n          {\n            \"id\": \"9ca7db0e-8128-49db-93f8-5a623359c0cd\",\n            \"leftValue\": \"={{ $json.telefonewhatsapp }}\",\n            \"rightValue\": \"\",\n            \"operator\": {\n              \"type\": \"string\",\n              \"operation\": \"notEmpty\",\n              \"singleValue\": true\n            }\n          }\n        ],\n        \"combinator\": \"and\"\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.if\",\n    \"typeVersion\": 2.2,\n    \"position\": [\n      1280,\n      160\n    ],\n    \"id\": \"4dae3b0a-4ad2-4b0b-a9e8-89ac49bf43b1\",\n    \"name\": \"Verificar se Cliente Cadastrado\",\n    \"alwaysOutputData\": false\n  },\n  {\n    \"parameters\": {\n      \"operation\": \"select\",\n      \"schema\": {\n        \"__rl\": true,\n        \"mode\": \"list\",\n        \"value\": \"public\"\n      },\n      \"table\": {\n        \"__rl\": true,\n        \"value\": \"empresa\",\n        \"mode\": \"list\",\n        \"cachedResultName\": \"empresa\"\n      },\n      \"where\": {\n        \"values\": [\n          {\n            \"column\": \"telefonewhatsapp\",\n            \"value\": \"={{ $json.numEmpresa }}\"\n          }\n        ]\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.postgres\",\n    \"typeVersion\": 2.6,\n    \"position\": [\n      660,\n      -140\n    ],\n    \"id\": \"b1f3d48d-4e11-465b-95c0-029289d199c1\",\n    \"name\": \"get_empresa1\",\n    \"credentials\": {\n      \"postgres\": {\n        \"id\": \"LqGFAFaRsmM4ACIk\",\n        \"name\": \"Postgres account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"operation\": \"update\",\n      \"schema\": {\n        \"__rl\": true,\n        \"mode\": \"list\",\n        \"value\": \"public\"\n      },\n      \"table\": {\n        \"__rl\": true,\n        \"value\": \"clientes\",\n        \"mode\": \"list\",\n        \"cachedResultName\": \"clientes\"\n      },\n      \"columns\": {\n        \"mappingMode\": \"defineBelow\",\n        \"value\": {\n          \"id\": \"={{ $json.id }}\",\n          \"idempresa\": \"={{ $json.id }}\",\n          \"telefonewhatsapp\": \"={{ $('A Empresa assumiu o atendimento?').item.json.numCilente }}\",\n          \"ativo\": \"false\"\n        },\n        \"matchingColumns\": [\n          \"telefonewhatsapp\",\n          \"idempresa\"\n        ],\n        \"schema\": [\n          {\n            \"id\": \"id\",\n            \"displayName\": \"id\",\n            \"required\": false,\n            \"defaultMatch\": true,\n            \"display\": true,\n            \"type\": \"number\",\n            \"canBeUsedToMatch\": true,\n            \"removed\": false\n          },\n          {\n            \"id\": \"nome\",\n            \"displayName\": \"nome\",\n            \"required\": true,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"string\",\n            \"canBeUsedToMatch\": true\n          },\n          {\n            \"id\": \"telefonewhatsapp\",\n            \"displayName\": \"telefonewhatsapp\",\n            \"required\": false,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"string\",\n            \"canBeUsedToMatch\": true,\n            \"removed\": false\n          },\n          {\n            \"id\": \"ativo\",\n            \"displayName\": \"ativo\",\n            \"required\": false,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"string\",\n            \"canBeUsedToMatch\": true\n          },\n          {\n            \"id\": \"conversationid\",\n            \"displayName\": \"conversationid\",\n            \"required\": false,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"string\",\n            \"canBeUsedToMatch\": true\n          },\n          {\n            \"id\": \"idempresa\",\n            \"displayName\": \"idempresa\",\n            \"required\": false,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"number\",\n            \"canBeUsedToMatch\": true,\n            \"removed\": false\n          },\n          {\n            \"id\": \"created_at\",\n            \"displayName\": \"created_at\",\n            \"required\": false,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"dateTime\",\n            \"canBeUsedToMatch\": true\n          }\n        ],\n        \"attemptToConvertTypes\": false,\n        \"convertFieldsToString\": false\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.postgres\",\n    \"typeVersion\": 2.6,\n    \"position\": [\n      860,\n      -60\n    ],\n    \"id\": \"8b2429e5-cf9c-40db-9d2f-e45c6b3edfd5\",\n    \"name\": \"update_cliente_ativo\",\n    \"credentials\": {\n      \"postgres\": {\n        \"id\": \"LqGFAFaRsmM4ACIk\",\n        \"name\": \"Postgres account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"schema\": {\n        \"__rl\": true,\n        \"mode\": \"list\",\n        \"value\": \"public\"\n      },\n      \"table\": {\n        \"__rl\": true,\n        \"value\": \"clientes\",\n        \"mode\": \"list\",\n        \"cachedResultName\": \"clientes\"\n      },\n      \"columns\": {\n        \"mappingMode\": \"defineBelow\",\n        \"value\": {\n          \"nome\": \"={{ $('Campos iniciais').item.json.nomeCliente }}\",\n          \"telefonewhatsapp\": \"={{ $('Campos iniciais').item.json.numCilente }}\",\n          \"idempresa\": \"={{ $('get_empresa').item.json.id }}\",\n          \"ativo\": \"true\"\n        },\n        \"matchingColumns\": [\n          \"id\"\n        ],\n        \"schema\": [\n          {\n            \"id\": \"id\",\n            \"displayName\": \"id\",\n            \"required\": false,\n            \"defaultMatch\": true,\n            \"display\": true,\n            \"type\": \"number\",\n            \"canBeUsedToMatch\": true\n          },\n          {\n            \"id\": \"nome\",\n            \"displayName\": \"nome\",\n            \"required\": true,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"string\",\n            \"canBeUsedToMatch\": true\n          },\n          {\n            \"id\": \"telefonewhatsapp\",\n            \"displayName\": \"telefonewhatsapp\",\n            \"required\": false,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"string\",\n            \"canBeUsedToMatch\": true\n          },\n          {\n            \"id\": \"ativo\",\n            \"displayName\": \"ativo\",\n            \"required\": false,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"string\",\n            \"canBeUsedToMatch\": true\n          },\n          {\n            \"id\": \"conversationid\",\n            \"displayName\": \"conversationid\",\n            \"required\": false,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"string\",\n            \"canBeUsedToMatch\": true\n          },\n          {\n            \"id\": \"idempresa\",\n            \"displayName\": \"idempresa\",\n            \"required\": false,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"number\",\n            \"canBeUsedToMatch\": true\n          },\n          {\n            \"id\": \"created_at\",\n            \"displayName\": \"created_at\",\n            \"required\": false,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"dateTime\",\n            \"canBeUsedToMatch\": true\n          }\n        ],\n        \"attemptToConvertTypes\": false,\n        \"convertFieldsToString\": false\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.postgres\",\n    \"typeVersion\": 2.6,\n    \"position\": [\n      1440,\n      320\n    ],\n    \"id\": \"52caca50-5508-4f32-89c8-1fa3ef42240a\",\n    \"name\": \"Postgres\",\n    \"credentials\": {\n      \"postgres\": {\n        \"id\": \"LqGFAFaRsmM4ACIk\",\n        \"name\": \"Postgres account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"conditions\": {\n        \"options\": {\n          \"caseSensitive\": true,\n          \"leftValue\": \"\",\n          \"typeValidation\": \"strict\",\n          \"version\": 2\n        },\n        \"conditions\": [\n          {\n            \"id\": \"54392bbd-3deb-4622-806a-1c17b80b5986\",\n            \"leftValue\": \"={{ $json.botativo }}\",\n            \"rightValue\": \"false\",\n            \"operator\": {\n              \"type\": \"string\",\n              \"operation\": \"equals\",\n              \"name\": \"filter.operator.equals\"\n            }\n          }\n        ],\n        \"combinator\": \"and\"\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.if\",\n    \"typeVersion\": 2.2,\n    \"position\": [\n      1680,\n      160\n    ],\n    \"id\": \"75991604-23a8-4fc8-8294-9914ae13931a\",\n    \"name\": \"BotInativo\"\n  },\n  {\n    \"parameters\": {},\n    \"type\": \"n8n-nodes-base.noOp\",\n    \"typeVersion\": 1,\n    \"position\": [\n      2000,\n      -80\n    ],\n    \"id\": \"57a29dd4-cd5e-43ee-a752-88367aaa02bd\",\n    \"name\": \"No Operation, do nothing\"\n  },\n  {\n    \"parameters\": {\n      \"conditions\": {\n        \"options\": {\n          \"caseSensitive\": true,\n          \"leftValue\": \"\",\n          \"typeValidation\": \"strict\",\n          \"version\": 2\n        },\n        \"conditions\": [\n          {\n            \"id\": \"bb0c009f-7be7-4280-9721-105151589181\",\n            \"leftValue\": \"={{ $('Campos iniciais').item.json.msgType }}\",\n            \"rightValue\": \"audioMessage\",\n            \"operator\": {\n              \"type\": \"string\",\n              \"operation\": \"equals\",\n              \"name\": \"filter.operator.equals\"\n            }\n          }\n        ],\n        \"combinator\": \"and\"\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.if\",\n    \"typeVersion\": 2.2,\n    \"position\": [\n      1980,\n      340\n    ],\n    \"id\": \"0f02a9fe-575a-45ce-a062-84283972d0ed\",\n    \"name\": \"If\"\n  },\n  {\n    \"parameters\": {\n      \"assignments\": {\n        \"assignments\": [\n          {\n            \"id\": \"13b5e01b-7b6b-4857-ba63-d1627d2ab906\",\n            \"name\": \"base64\",\n            \"value\": \"={{ $('Campos iniciais').item.json.base64 }}\",\n            \"type\": \"string\"\n          }\n        ]\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.set\",\n    \"typeVersion\": 3.4,\n    \"position\": [\n      2240,\n      160\n    ],\n    \"id\": \"e6b607de-22ac-4d74-b7d0-5a45dfe3fbd4\",\n    \"name\": \"Edit Fields\"\n  },\n  {\n    \"parameters\": {\n      \"operation\": \"toBinary\",\n      \"sourceProperty\": \"base64\",\n      \"options\": {\n        \"fileName\": \"audio.mp3\",\n        \"mimeType\": \"audio/mpeg\"\n      }\n    },\n    \"type\": \"n8n-nodes-base.convertToFile\",\n    \"typeVersion\": 1.1,\n    \"position\": [\n      2460,\n      160\n    ],\n    \"id\": \"04e09415-c11a-4441-9087-f8b0b94cdf85\",\n    \"name\": \"Convert to File\"\n  },\n  {\n    \"parameters\": {\n      \"resource\": \"audio\",\n      \"operation\": \"transcribe\",\n      \"options\": {}\n    },\n    \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n    \"typeVersion\": 1.8,\n    \"position\": [\n      2680,\n      160\n    ],\n    \"id\": \"1ab1508b-544f-4d1e-bb5e-bdd72b07950a\",\n    \"name\": \"OpenAI\",\n    \"credentials\": {\n      \"openAiApi\": {\n        \"id\": \"UM486K0DSVLyeNZp\",\n        \"name\": \"OpenAi account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"assignments\": {\n        \"assignments\": [\n          {\n            \"id\": \"d02c8398-ab90-40b9-8469-6ddc9935fafa\",\n            \"name\": \"msg\",\n            \"value\": \"={{ $('A Empresa assumiu o atendimento?').item.json.msg }}{{ $json.text }}\",\n            \"type\": \"string\"\n          }\n        ]\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.set\",\n    \"typeVersion\": 3.4,\n    \"position\": [\n      2920,\n      380\n    ],\n    \"id\": \"59bbfb8a-108c-40ce-a233-216896c9c606\",\n    \"name\": \"Edit Fields1\"\n  },\n  {\n    \"parameters\": {\n      \"operation\": \"push\",\n      \"list\": \"={{ $('Campos iniciais').item.json.instanceIDtelcliente }}\",\n      \"messageData\": \"={{ $json.msg }}\",\n      \"tail\": true\n    },\n    \"type\": \"n8n-nodes-base.redis\",\n    \"typeVersion\": 1,\n    \"position\": [\n      3220,\n      380\n    ],\n    \"id\": \"531ecf34-002c-46af-b9d0-54e6814a4eba\",\n    \"name\": \"Criar lista e incluir msgs\",\n    \"credentials\": {\n      \"redis\": {\n        \"id\": \"Cox7XtTFAJAhBy53\",\n        \"name\": \"Redis account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"operation\": \"get\",\n      \"key\": \"={{ $('Campos iniciais').item.json.instanceIDtelcliente }}\",\n      \"keyType\": \"=automatic\",\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.redis\",\n    \"typeVersion\": 1,\n    \"position\": [\n      3980,\n      380\n    ],\n    \"id\": \"ece849a3-e49b-42f1-ae19-a4305f1d6986\",\n    \"name\": \"Obter Lista\",\n    \"credentials\": {\n      \"redis\": {\n        \"id\": \"Cox7XtTFAJAhBy53\",\n        \"name\": \"Redis account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"conditions\": {\n        \"options\": {\n          \"caseSensitive\": true,\n          \"leftValue\": \"\",\n          \"typeValidation\": \"strict\",\n          \"version\": 2\n        },\n        \"conditions\": [\n          {\n            \"id\": \"c63c0c47-ed30-4526-8b20-3b8a52d14144\",\n            \"leftValue\": \"={{ $json.propertyName.last() }}\",\n            \"rightValue\": \"={{ $('Edit Fields1').item.json.msg }}\",\n            \"operator\": {\n              \"type\": \"string\",\n              \"operation\": \"notEquals\"\n            }\n          }\n        ],\n        \"combinator\": \"and\"\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.if\",\n    \"typeVersion\": 2.2,\n    \"position\": [\n      4240,\n      420\n    ],\n    \"id\": \"178213cd-2177-40f9-892a-9952858b0d46\",\n    \"name\": \"O ultimo registro da lista é diferente do Edit Field Msg?\"\n  },\n  {\n    \"parameters\": {},\n    \"type\": \"n8n-nodes-base.noOp\",\n    \"typeVersion\": 1,\n    \"position\": [\n      4460,\n      320\n    ],\n    \"id\": \"91ce747a-7d8e-4496-8ca6-34d88dd48514\",\n    \"name\": \"No Operation, do nothing1\"\n  },\n  {\n    \"parameters\": {\n      \"operation\": \"delete\",\n      \"key\": \"={{ $('Campos iniciais').item.json.instanceIDtelcliente }}\"\n    },\n    \"type\": \"n8n-nodes-base.redis\",\n    \"typeVersion\": 1,\n    \"position\": [\n      4580,\n      520\n    ],\n    \"id\": \"6fbae5bc-027e-4121-9969-bde971574361\",\n    \"name\": \"Delete Lista\",\n    \"credentials\": {\n      \"redis\": {\n        \"id\": \"Cox7XtTFAJAhBy53\",\n        \"name\": \"Redis account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"amount\": 3\n    },\n    \"type\": \"n8n-nodes-base.wait\",\n    \"typeVersion\": 1.1,\n    \"position\": [\n      3620,\n      400\n    ],\n    \"id\": \"61c948f3-f84d-4b88-912e-8764148a9532\",\n    \"name\": \"Wait1\",\n    \"webhookId\": \"8124ce90-4155-47ff-8eb6-4b815305cef6\"\n  },\n  {\n    \"parameters\": {\n      \"assignments\": {\n        \"assignments\": [\n          {\n            \"id\": \"109e527d-040b-445a-8f5c-cc2a34c69c03\",\n            \"name\": \"Mensagem\",\n            \"value\": \"={{ $json[\\\"propertyName\\\"].join(\\\", \\\") }}\",\n            \"type\": \"string\"\n          },\n          {\n            \"id\": \"b328fe2a-12c8-4b3f-bd9d-e2a4659c413a\",\n            \"name\": \"ConversationID\",\n            \"value\": \"={{ $('get_cliente').item.json.conversationid }}\",\n            \"type\": \"string\"\n          }\n        ]\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.set\",\n    \"typeVersion\": 3.4,\n    \"position\": [\n      4860,\n      620\n    ],\n    \"id\": \"f0be58bd-ed13-4ce9-a5a6-fdd0f62caf77\",\n    \"name\": \"Edit Fields2\"\n  },\n  {\n    \"parameters\": {\n      \"conditions\": {\n        \"options\": {\n          \"caseSensitive\": true,\n          \"leftValue\": \"\",\n          \"typeValidation\": \"strict\",\n          \"version\": 2\n        },\n        \"conditions\": [\n          {\n            \"id\": \"fa099e4e-6d1f-4651-aa36-5987ca8bd10d\",\n            \"leftValue\": \"={{ $('get_cliente').item.json.conversationid }}\",\n            \"rightValue\": \"\",\n            \"operator\": {\n              \"type\": \"string\",\n              \"operation\": \"empty\",\n              \"singleValue\": true\n            }\n          }\n        ],\n        \"combinator\": \"and\"\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.if\",\n    \"typeVersion\": 2.2,\n    \"position\": [\n      6300,\n      780\n    ],\n    \"id\": \"0ace2e20-6829-413e-9473-51309e495eea\",\n    \"name\": \"Verifica se cliente ja tem conversa iniciada\"\n  },\n  {\n    \"parameters\": {\n      \"operation\": \"update\",\n      \"schema\": {\n        \"__rl\": true,\n        \"mode\": \"list\",\n        \"value\": \"public\"\n      },\n      \"table\": {\n        \"__rl\": true,\n        \"value\": \"clientes\",\n        \"mode\": \"list\",\n        \"cachedResultName\": \"clientes\"\n      },\n      \"columns\": {\n        \"mappingMode\": \"defineBelow\",\n        \"value\": {\n          \"conversationid\": \"={{ $json.conversation_id }}\",\n          \"telefonewhatsapp\": \"={{ $('Campos iniciais').item.json.numCilente }}\",\n          \"idempresa\": \"={{ $('get_empresa').item.json.id }}\"\n        },\n        \"matchingColumns\": [\n          \"telefonewhatsapp\",\n          \"idempresa\"\n        ],\n        \"schema\": [\n          {\n            \"id\": \"id\",\n            \"displayName\": \"id\",\n            \"required\": false,\n            \"defaultMatch\": true,\n            \"display\": true,\n            \"type\": \"number\",\n            \"canBeUsedToMatch\": true,\n            \"removed\": true\n          },\n          {\n            \"id\": \"nome\",\n            \"displayName\": \"nome\",\n            \"required\": true,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"string\",\n            \"canBeUsedToMatch\": true,\n            \"removed\": true\n          },\n          {\n            \"id\": \"telefonewhatsapp\",\n            \"displayName\": \"telefonewhatsapp\",\n            \"required\": false,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"string\",\n            \"canBeUsedToMatch\": true,\n            \"removed\": false\n          },\n          {\n            \"id\": \"ativo\",\n            \"displayName\": \"ativo\",\n            \"required\": false,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"string\",\n            \"canBeUsedToMatch\": true,\n            \"removed\": true\n          },\n          {\n            \"id\": \"conversationid\",\n            \"displayName\": \"conversationid\",\n            \"required\": false,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"string\",\n            \"canBeUsedToMatch\": true\n          },\n          {\n            \"id\": \"idempresa\",\n            \"displayName\": \"idempresa\",\n            \"required\": false,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"number\",\n            \"canBeUsedToMatch\": true,\n            \"removed\": false\n          },\n          {\n            \"id\": \"created_at\",\n            \"displayName\": \"created_at\",\n            \"required\": false,\n            \"defaultMatch\": false,\n            \"display\": true,\n            \"type\": \"dateTime\",\n            \"canBeUsedToMatch\": true,\n            \"removed\": true\n          }\n        ],\n        \"attemptToConvertTypes\": false,\n        \"convertFieldsToString\": false\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.postgres\",\n    \"typeVersion\": 2.6,\n    \"position\": [\n      6720,\n      560\n    ],\n    \"id\": \"63d9a162-df8c-4a5a-b1e0-38dcb4455389\",\n    \"name\": \"Postgres1\",\n    \"credentials\": {\n      \"postgres\": {\n        \"id\": \"LqGFAFaRsmM4ACIk\",\n        \"name\": \"Postgres account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {},\n    \"type\": \"n8n-nodes-base.merge\",\n    \"typeVersion\": 3.1,\n    \"position\": [\n      7000,\n      880\n    ],\n    \"id\": \"86d030c6-7116-4180-8679-36fc73e57c21\",\n    \"name\": \"Merge\"\n  },\n  {\n    \"parameters\": {\n      \"model\": {\n        \"__rl\": true,\n        \"value\": \"gpt-4o-mini\",\n        \"mode\": \"list\",\n        \"cachedResultName\": \"gpt-4o-mini\"\n      },\n      \"options\": {}\n    },\n    \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n    \"typeVersion\": 1.2,\n    \"position\": [\n      5060,\n      880\n    ],\n    \"id\": \"a6727d4e-5070-4b54-8b15-474f8b37f75b\",\n    \"name\": \"OpenAI Chat Model\",\n    \"credentials\": {\n      \"openAiApi\": {\n        \"id\": \"UM486K0DSVLyeNZp\",\n        \"name\": \"OpenAi account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"sessionIdType\": \"customKey\",\n      \"sessionKey\": \"={{ $('get_cliente').item.json.telefonewhatsapp }}\",\n      \"contextWindowLength\": 50\n    },\n    \"type\": \"@n8n/n8n-nodes-langchain.memoryPostgresChat\",\n    \"typeVersion\": 1.3,\n    \"position\": [\n      5220,\n      920\n    ],\n    \"id\": \"b9d84f43-83a7-4ee3-8fce-7d54801c205f\",\n    \"name\": \"Postgres Chat Memory\",\n    \"credentials\": {\n      \"postgres\": {\n        \"id\": \"LqGFAFaRsmM4ACIk\",\n        \"name\": \"Postgres account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"promptType\": \"define\",\n      \"text\": \"={{ $json.Mensagem }}\",\n      \"options\": {\n        \"systemMessage\": \"=HOJE É: {{ $now }}\\nTELEFONE DO CONTATO: \\n{{$('get_cliente').item.json.telefonewhatsapp }}\\n\\nINSTRUÇÃO IMPORTANTE:\\n- Ao criar ou editar qualquer exame no Google Calendar, incluir sempre o telefone do paciente na descrição do agendamento, juntamente com o nome completo, data de nascimento, **unidade escolhida** (Mooca ou Ipiranga) e quaisquer outras informações clínicas relevantes fornecidas pelo paciente.\\n\\n------------------------------------------------------------------------------------\\nPAPEL:\\nVocê é uma atendente do WhatsApp, altamente especializada, que atua em nome da Clínica de Radiologia Papaiz, prestando um serviço de excelência. Sua missão é atender aos pacientes de maneira ágil e eficiente, respondendo dúvidas e auxiliando em agendamentos, cancelamentos ou remarcações de **exames radiológicos**.\\n\\nPERSONALIDADE E TOM DE VOZ:\\n- Simpática, prestativa e humana\\n- Tom de voz sempre simpático, acolhedor e respeitoso\\n\\nOBJETIVO:\\n1. Fornecer atendimento diferenciado e cuidadoso aos pacientes.\\n2. Responder dúvidas sobre a clínica (exames, horários, localização, formas de pagamento).\\n3. Agendar, remarcar e cancelar exames de forma simples e eficaz.\\n4. Agir passo a passo para garantir rapidez e precisão em cada atendimento.\\n\\nCONTEXTO:\\n- Você otimiza o fluxo interno da clínica, provendo informações e reduzindo a carga administrativa dos profissionais da radiologia.\\n- Seu desempenho impacta diretamente a satisfação do paciente e a eficiência das operações clínicas.\\n\\n------------------------------------------------------------------------------------\\nSOP (Procedimento Operacional Padrão):\\n\\n1. Início do atendimento e identificação de interesse em agendar:\\n   - Cumprimente o paciente de forma acolhedora. \\n   - Explique que é possível agendar por texto.\\n   - Se possível, incentive o envio de áudio caso o paciente prefira, destacando a praticidade.\\n\\n2. Solicitar dados do paciente:\\n   - Peça nome completo e data de nascimento.\\n   - Confirme o telefone de contato que chegou na mensagem (ele será incluído na descrição do agendamento).\\n   - Pergunte **qual unidade deseja agendar: Mooca ou Ipiranga**.\\n\\n3. Identificar necessidade:\\n   - Pergunte qual exame o paciente deseja realizar.\\n   - Solicite data de preferência e se o paciente tem preferência por turno (manhã ou tarde).\\n\\n3.1. Identificar forma de atendimento:\\n   - Pergunte ao paciente: \\\"Você fará o exame por convênio ou particular?\\\"\\n   - Se o paciente responder **convênio**:\\n     - Pergunte: \\\"Qual é o seu convênio, por favor?\\\"\\n     - Responda: \\\"Perfeito! O convênio <convenio informado na mensagem> é aceito aqui na clínica.\\\"\\n     - Anote essa informação e **inclua o nome do convênio na descrição do evento** no Google Calendar.\\n\\n   - Se o paciente responder **particular**:\\n     - Informe: \\\"Perfeito! O atendimento particular será registrado normalmente. Em breve uma pessoa da clínica entrará em contato por telefone para confirmar os detalhes do pagamento e concluir o agendamento.\\\"\\n     - Continue coletando os dados normalmente (tipo de exame, data, turno, unidade etc.).\\n     - Ao usar a tool **create_evento**, **adicione “[PENDENTE]” no título do evento** para sinalizar que ainda será confirmado por telefone.\\n\\n\\n4. Verificar disponibilidade:\\n   - Use as tools do calendar apenas após ter todos os dados e a unidade definidos.\\n   - Use a tool **get_all_eventos** da unidade escolhida (Mooca ou Ipiranga) para obter os horários disponíveis.\\n\\n5. Informar disponibilidade:\\n   - Retorne ao paciente com os horários livres encontrados para a data e unidade solicitadas.\\n\\n6. Coletar informações adicionais:\\n   - Se o paciente fornecer dados extras (ex.: médico solicitante, convênio, tipo de exame, condições de saúde), inclua tudo na descrição do evento no Google Calendar.\\n\\n7. Agendar exame:\\n   - Após confirmação do paciente:\\n     - Use a tool **create_evento** da unidade selecionada para criar o evento, passando:\\n       - Nome completo\\n       - Data de nascimento\\n       - Telefone de contato\\n       - Unidade (Mooca ou Ipiranga) <o id na lista de calendários é Mooca=e73934158b72b3e2697775ad8c10ce47dc6b9061f07130415c005546ab3ffd4c@group.calendar.google.com ou Ipiranga=b8151cd4fcb90454ddfd02b5d41b7485ea45fa55a0e6bf7ae62ac07ab6d99cba@group.calendar.google.com\\n)>\\n       - Tipo de exame\\n       - Data e hora escolhidas\\n       - Informações adicionais\\n     - Nunca agende datas ou horários passados ou com conflitos.\\n\\n8. Confirmar agendamento:\\n   - Espere o retorno de sucesso da **create_evento** e então confirme com o paciente.\\n\\n------------------------------------------------------------------------------------\\nINSTRUÇÕES GERAIS:\\n\\n1. Respostas claras, objetivas e úteis:\\n   - Forneça informações sobre tipos de exame, horários, endereço, valores e convênios.\\n\\n2. Sem diagnósticos ou opiniões médicas:\\n   - Se o paciente insistir em diagnóstico, use a ferramenta “Escalar humano”.\\n\\n3. Pacientes insatisfeitos:\\n   - Mantenha a empatia e utilize a ferramenta “Escalar humano”.\\n\\n4. Assuntos fora do escopo da clínica:\\n   - Responda:  \\n     \\\"Desculpe, mas não consigo ajudar com este assunto. Por favor, entre em contato pelo número 0800 940 000. Enviei uma cópia da nossa conversa para o gestor de atendimento.\\\"\\n\\n5. Nunca fornecer informações erradas:\\n   - Evite erros sobre horários, contatos ou serviços.\\n\\n6. Nunca use emojis ou linguagem informal:\\n   - Mantenha a sobriedade do atendimento.\\n\\n7. Nunca confirme exames sem o retorno do **create_evento** da unidade correspondente:\\n   - Garanta que o evento foi criado com sucesso antes de dar a resposta final.\\n\\n8. Dupla verificação:\\n   - Confirme sempre os dados e a **unidade escolhida** para evitar equívocos.\\n\\n------------------------------------------------------------------------------------\\nHORÁRIOS DE FUNCIONAMENTO:\\n- Segunda a Sábado: 07h às 18h\\n- Domingo e Feriados: Fechado\\n\\nLOCALIZAÇÕES E CONTATO:\\n1. **Unidade Mooca**  \\n   - Endereço: Rua dos Exames, 123 - Mooca, São Paulo - SP  \\n   - Telefone: (11) 3234-5678\\n\\n2. **Unidade Ipiranga**  \\n   - Endereço: Rua dos Radiologistas, 456 - Ipiranga, São Paulo - SP  \\n   - Telefone: (11) 3298-1234\\n\\n- WhatsApp Geral: (11) 98888-1234  \\n- E-mail: atendimento@papaizradiologia.com.br  \\n- Site: www.papaizradiologia.com.br\\n\\nEXAMES E ESPECIALIDADES:\\n- Radiografia Odontológica\\n- Tomografia Computadorizada\\n- Documentação Ortodôntica Completa\\n\\nVALORES E FORMAS DE PAGAMENTO:\\n- Valores variam conforme o exame solicitado\\n- Formas de pagamento: PIX, dinheiro, cartão de débito ou crédito\\n- Convênios aceitos: Odontoprev, Bradesco Dental, SulAmérica, Amil Dental\\n\\n------------------------------------------------------------------------------------\\nTOOLS:\\n\\n1. create_evento  \\n   - Usada para agendar um novo exame no Google Calendar da **unidade correta**.  \\n   - IDs dos calendários:  \\n     - Mooca = e73934158b72b3e2697775ad8c10ce47dc6b9061f07130415c005546ab3ffd4c@group.calendar.google.com  \\n     - Ipiranga = b8151cd4fcb90454ddfd02b5d41b7485ea45fa55a0e6bf7ae62ac07ab6d99cba@group.calendar.google.com  \\n   - Deve conter obrigatoriamente:\\n     - Nome completo (no título do evento; incluir prefixo [PENDENTE] se for particular)\\n     - Data de nascimento\\n     - Telefone do paciente\\n     - Unidade (Mooca ou Ipiranga)\\n     - Tipo de exame\\n     - Data e hora agendadas\\n     - Informações adicionais:\\n       - Se for convênio, inclua o nome do convênio na descrição\\n       - Se for particular, inclua a nota: “Paciente será contatado para confirmação de pagamento (atendimento particular)”\\n\\n\\n2. update_eventos  \\n    <\\n      o id na lista de calendários é Mooca=e73934158b72b3e2697775ad8c10ce47dc6b9061f07130415c005546ab3ffd4c@group.calendar.google.com Ipiranga=b8151cd4fcb90454ddfd02b5d41b7485ea45fa55a0e6bf7ae62ac07ab6d99cba@group.calendar.google.com\\n      >  \\n    - Usada para alterar dados de um evento já criado:\\n     - Mudar data, hora ou unidade\\n     - Corrigir dados do paciente\\n     - Adicionar \\\"[Confirmado]\\\" ao título do evento\\n\\n3. get_all_eventos  \\n    <\\n      o id na lista de calendários é Mooca=e73934158b72b3e2697775ad8c10ce47dc6b9061f07130415c005546ab3ffd4c@group.calendar.google.com Ipiranga=b8151cd4fcb90454ddfd02b5d41b7485ea45fa55a0e6bf7ae62ac07ab6d99cba@group.calendar.google.com\\n      >  \\n\\n- Usada para listar todos os eventos agendados em uma data específica na **unidade desejada**.  \\n   - Requer:\\n     - Nome completo\\n     - Data de nascimento\\n     - Exame desejado\\n     - Data de preferência\\n     - Unidade\\n\\n4. get_evento  \\n    <\\n      o id na lista de calendários é Mooca=e73934158b72b3e2697775ad8c10ce47dc6b9061f07130415c005546ab3ffd4c@group.calendar.google.com Ipiranga=b8151cd4fcb90454ddfd02b5d41b7485ea45fa55a0e6bf7ae62ac07ab6d99cba@group.calendar.google.com\\n      >  \\n\\n- Usada para consultar detalhes específicos de um exame agendado com base no ID do evento.\\n\\n5. delete_evento  \\n    <\\n      o id na lista de calendários é Mooca=e73934158b72b3e2697775ad8c10ce47dc6b9061f07130415c005546ab3ffd4c@group.calendar.google.com Ipiranga=b8151cd4fcb90454ddfd02b5d41b7485ea45fa55a0e6bf7ae62ac07ab6d99cba@group.calendar.google.com\\n      >  \\n- Usada para remover um agendamento de uma unidade.  \\n   - Após deletar, use “Enviar telegram cancelamento” com nome, data, hora e unidade.\\n\\n------------------------------------------------------------------------------------\\nEXEMPLOS DE FLUXO:\\n\\n1. Marcar exame\\n   - Paciente: \\\"Quero marcar um exame\\\"\\n   - Você:\\n     - Cumprimente, explique que pode agendar por texto.\\n     - Solicite nome completo, data de nascimento e confirme o telefone.\\n     - Pergunte: \\\"Você fará o exame por convênio ou particular?\\\"\\n       - Se for convênio:\\n         - Pergunte: \\\"Qual é o seu convênio?\\\"\\n         - Confirme que o convênio é aceito.\\n         - Anote essa informação e continue normalmente.\\n       - Se for particular:\\n         - Diga: \\\"Perfeito! Em breve entraremos em contato por telefone para confirmar os detalhes do pagamento.\\\"\\n         - O evento deve ser criado com **[PENDENTE]** no título e incluir essa observação na descrição.\\n     - Pergunte unidade (Mooca ou Ipiranga), tipo de exame, data e turno.\\n     - Use **get_all_eventos** da unidade.\\n     - Informe horários disponíveis.\\n     - Agende com **create_evento** conforme a regra de convênio ou particular.\\n     - Confirme com o paciente.\\n\\n\\n2. Remarcar exame\\n   - Paciente: \\\"Não poderei ir amanhã, quero remarcar.\\\"\\n   - Você:\\n     - Solicite nome completo, data de nascimento e exame.\\n     - Pergunte **unidade agendada**.\\n     - Solicite nova data e turno preferidos.\\n     - Use **update_eventos** da unidade.\\n     - Confirme após o sucesso.\\n\\n3. Cancelar exame\\n   - Paciente: \\\"Preciso cancelar meu exame.\\\"\\n   - Você:\\n     - Solicite nome completo, data de nascimento, exame e **unidade**.\\n     - Use **delete_evento** da unidade.\\n     - Use \\\"Enviar telegram cancelamento\\\".\\n     - Confirme o cancelamento ao paciente.\\n\\n4. Mensagens de confirmação com ID do evento:\\n   - Paciente: \\\"Confirmar, ID do evento\\\"\\n     - Use **update_eventos** para incluir “[Confirmado]” no título do evento.\\n     - Confirme ao paciente que está tudo certo.\\n\\n   - Paciente: \\\"Reagendar, ID do evento\\\"\\n     - Use **delete_evento** para excluir.\\n     - Envie link de agendamento rápido.\\n     - Oriente o paciente a escolher novo horário e unidade.\\n\\n------------------------------------------------------------------------------------\\nOBSERVAÇÕES FINAIS:\\n\\n- Nunca forneça diagnósticos ou opiniões médicas.\\n- Direcione qualquer dúvida fora do escopo à ferramenta “Escalar humano”.\\n- Mantenha o tom profissional, claro e respeitoso. NÃO utilize emojis.\\n- Link da agenda online: https://calendar.app.google/k43eFCyMvQts1ZSs9\\n- Só agendar datas futuras, nunca passadas.\\n- Nunca diga que é assistente virtual — faça um atendimento **humanizado**.\\n- Use **update_eventos** para adicionar “[Confirmado]” quando o paciente confirmar com ID do evento.\\n- Se o exame for particular, o evento criado no Google Calendar deve conter no **título** o prefixo [PENDENTE], e na descrição a anotação:  \\n  “Paciente será contatado por telefone para confirmar pagamento. Atendimento particular.”\\n- Se o exame for por convênio, o nome do convênio deve constar claramente na descrição do evento.\\n\\n\"\n      }\n    },\n    \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n    \"typeVersion\": 1.8,\n    \"position\": [\n      5380,\n      620\n    ],\n    \"id\": \"33c80832-7461-4e3a-b968-318fc1511866\",\n    \"name\": \"Assistente Clínica\",\n    \"retryOnFail\": true,\n    \"waitBetweenTries\": 1000\n  },\n  {\n    \"parameters\": {\n      \"method\": \"POST\",\n      \"url\": \"http://auto.machiron.com.br:8080/message/sendText/machironv1\",\n      \"sendHeaders\": true,\n      \"headerParameters\": {\n        \"parameters\": [\n          {\n            \"name\": \"apikey\",\n            \"value\": \"A42123F57793-4847-AF10-C984C2F2854D\"\n          }\n        ]\n      },\n      \"sendBody\": true,\n      \"bodyParameters\": {\n        \"parameters\": [\n          {\n            \"name\": \"number\",\n            \"value\": \"={{ $('get_cliente').item.json.telefonewhatsapp }}\"\n          },\n          {\n            \"name\": \"text\",\n            \"value\": \"={{ $('AI Agent').item.json.output }}\"\n          }\n        ]\n      },\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.httpRequest\",\n    \"typeVersion\": 4.2,\n    \"position\": [\n      8420,\n      640\n    ],\n    \"id\": \"1db644d5-d354-47e6-a18d-fd1bf2886d48\",\n    \"name\": \"Responder usuário no WhatsApp\"\n  },\n  {\n    \"parameters\": {\n      \"promptType\": \"define\",\n      \"text\": \"={{ $('Assistente Clínica').item.json.output }}\",\n      \"options\": {\n        \"systemMessage\": \"Você é especialista em formatação de mensagem para whataspp, trabalhando somente na formatação e não alterando o conteúdo da menssagem.\\n\\n- Substitua ** por *\\n- Remova #\"\n      }\n    },\n    \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n    \"typeVersion\": 1.8,\n    \"position\": [\n      7620,\n      640\n    ],\n    \"id\": \"068e6051-99ba-476c-b877-e96914a98ad3\",\n    \"name\": \"AI Agent\"\n  },\n  {\n    \"parameters\": {\n      \"model\": {\n        \"__rl\": true,\n        \"mode\": \"list\",\n        \"value\": \"gpt-4o-mini\"\n      },\n      \"options\": {}\n    },\n    \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n    \"typeVersion\": 1.2,\n    \"position\": [\n      7620,\n      840\n    ],\n    \"id\": \"691608ae-648c-4a58-b841-9267d2edc07b\",\n    \"name\": \"OpenAI Chat Model2\",\n    \"credentials\": {\n      \"openAiApi\": {\n        \"id\": \"UM486K0DSVLyeNZp\",\n        \"name\": \"OpenAi account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"content\": \"# Agente (Tools, MCP, Memória, Modelo LLM)\",\n      \"height\": 960,\n      \"width\": 1100,\n      \"color\": 3\n    },\n    \"type\": \"n8n-nodes-base.stickyNote\",\n    \"typeVersion\": 1,\n    \"position\": [\n      5000,\n      480\n    ],\n    \"id\": \"ec13f531-5497-4806-af72-c51dc5362134\",\n    \"name\": \"Sticky Note2\"\n  },\n  {\n    \"parameters\": {\n      \"content\": \"# Tratar e enviar mensagens de resposta WhatsApp \\n\",\n      \"height\": 640,\n      \"width\": 1220,\n      \"color\": 4\n    },\n    \"type\": \"n8n-nodes-base.stickyNote\",\n    \"typeVersion\": 1,\n    \"position\": [\n      7560,\n      400\n    ],\n    \"id\": \"9cc0e9a1-a923-4db3-acb3-dd860bb828ca\",\n    \"name\": \"Sticky Note3\"\n  },\n  {\n    \"parameters\": {\n      \"method\": \"POST\",\n      \"url\": \"=http://auto.machiron.com.br:8080/chat/sendPresence/{{ $('Webhook').item.json.body.instance }}\",\n      \"sendHeaders\": true,\n      \"headerParameters\": {\n        \"parameters\": [\n          {\n            \"name\": \"apikey\",\n            \"value\": \"={{ $('Webhook').item.json.body.apikey }}\"\n          }\n        ]\n      },\n      \"sendBody\": true,\n      \"specifyBody\": \"json\",\n      \"jsonBody\": \"={\\n  \\\"number\\\": \\\"{{ $('get_cliente').item.json.telefonewhatsapp }}\\\",\\n  \\\"delay\\\": 3000,\\n  \\\"presence\\\": \\\"composing\\\"\\n}\",\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.httpRequest\",\n    \"typeVersion\": 4.2,\n    \"position\": [\n      8100,\n      640\n    ],\n    \"id\": \"58217ff1-31ac-45af-8107-286d9831887c\",\n    \"name\": \"HTTP Request - Status Digitando1\",\n    \"alwaysOutputData\": true\n  },\n  {\n    \"parameters\": {\n      \"operation\": \"get\",\n      \"calendar\": {\n        \"__rl\": true,\n        \"value\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Calendar', ``, 'string') }}\",\n        \"mode\": \"id\",\n        \"__regex\": \"(^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\\\.[a-zA-Z0-9-]+)*)\"\n      },\n      \"eventId\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}\",\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.googleCalendarTool\",\n    \"typeVersion\": 1.3,\n    \"position\": [\n      5640,\n      1020\n    ],\n    \"id\": \"44a88f7f-8d67-4012-b61d-c39fe4c7bb8c\",\n    \"name\": \"get_evento\",\n    \"credentials\": {\n      \"googleCalendarOAuth2Api\": {\n        \"id\": \"IWcMYX5Jg2REY5RT\",\n        \"name\": \"Google Calendar account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"operation\": \"delete\",\n      \"calendar\": {\n        \"__rl\": true,\n        \"value\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Calendar', ``, 'string') }}\",\n        \"mode\": \"id\",\n        \"__regex\": \"(^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\\\.[a-zA-Z0-9-]+)*)\"\n      },\n      \"eventId\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}\",\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.googleCalendarTool\",\n    \"typeVersion\": 1.3,\n    \"position\": [\n      5520,\n      1020\n    ],\n    \"id\": \"87e1eee8-72d2-406c-8a02-2c7da2d65155\",\n    \"name\": \"delete_evento\",\n    \"credentials\": {\n      \"googleCalendarOAuth2Api\": {\n        \"id\": \"IWcMYX5Jg2REY5RT\",\n        \"name\": \"Google Calendar account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"calendar\": {\n        \"__rl\": true,\n        \"value\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Calendar', ``, 'string') }}\",\n        \"mode\": \"id\",\n        \"__regex\": \"(^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\\\.[a-zA-Z0-9-]+)*)\"\n      },\n      \"start\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}\",\n      \"end\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}\",\n      \"additionalFields\": {\n        \"attendees\": [],\n        \"description\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', ``, 'string') }}\",\n        \"summary\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Summary', ``, 'string') }}\"\n      }\n    },\n    \"type\": \"n8n-nodes-base.googleCalendarTool\",\n    \"typeVersion\": 1.3,\n    \"position\": [\n      5400,\n      1020\n    ],\n    \"id\": \"1de5ebba-5df1-4d08-a264-4730e565b214\",\n    \"name\": \"create_evento\",\n    \"credentials\": {\n      \"googleCalendarOAuth2Api\": {\n        \"id\": \"IWcMYX5Jg2REY5RT\",\n        \"name\": \"Google Calendar account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"operation\": \"getAll\",\n      \"calendar\": {\n        \"__rl\": true,\n        \"value\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Calendar', ``, 'string') }}\",\n        \"mode\": \"id\",\n        \"__regex\": \"(^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\\\.[a-zA-Z0-9-]+)*)\"\n      },\n      \"limit\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}\",\n      \"timeMin\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', ``, 'string') }}\",\n      \"timeMax\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Before', ``, 'string') }}\",\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.googleCalendarTool\",\n    \"typeVersion\": 1.3,\n    \"position\": [\n      5760,\n      1020\n    ],\n    \"id\": \"bd4eb366-7320-45fe-8425-460388ca2379\",\n    \"name\": \"get_all_eventos\",\n    \"credentials\": {\n      \"googleCalendarOAuth2Api\": {\n        \"id\": \"IWcMYX5Jg2REY5RT\",\n        \"name\": \"Google Calendar account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"operation\": \"update\",\n      \"calendar\": {\n        \"__rl\": true,\n        \"value\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Calendar', ``, 'string') }}\",\n        \"mode\": \"id\",\n        \"__regex\": \"(^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\\\.[a-zA-Z0-9-]+)*)\"\n      },\n      \"eventId\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}\",\n      \"updateFields\": {\n        \"description\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', ``, 'string') }}\",\n        \"end\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}\",\n        \"start\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}\",\n        \"summary\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Summary', ``, 'string') }}\"\n      }\n    },\n    \"type\": \"n8n-nodes-base.googleCalendarTool\",\n    \"typeVersion\": 1.3,\n    \"position\": [\n      5900,\n      1020\n    ],\n    \"id\": \"ce0e57f1-512b-4f51-ae27-72e183192e7b\",\n    \"name\": \"update_evento\",\n    \"credentials\": {\n      \"googleCalendarOAuth2Api\": {\n        \"id\": \"IWcMYX5Jg2REY5RT\",\n        \"name\": \"Google Calendar account\"\n      }\n    }\n  },\n  {\n    \"parameters\": {\n      \"operation\": \"text\",\n      \"options\": {}\n    },\n    \"type\": \"n8n-nodes-base.extractFromFile\",\n    \"typeVersion\": 1,\n    \"position\": [\n      0,\n      0\n    ],\n    \"id\": \"f4c95861-a4ea-4e52-87b5-bedfaf89954d\",\n    \"name\": \"Extract from File\"\n  }\n]\n"}]